Largely based on FlexGen now
